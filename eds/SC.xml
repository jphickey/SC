<?xml version="1.0" encoding="UTF-8"?>
<!--

    GSC-18128-1, "Core Flight Executive Version 6.7"
    LEW-19710-1, "CCSDS electronic data sheet implementation"

    Copyright (c) 2006-2019 United States Government as represented by
    the Administrator of the National Aeronautics and Space Administration.
    All Rights Reserved.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

    This document adheres to the Electronic Data Sheet (EDS) XML schema
    as prescribed in CCSDS book 876.0.

    Purpose:
      This describes all interface objects for the Executive Services (CFE_ES)
      core application

-->
<PackageFile xmlns="http://www.ccsds.org/schema/sois/seds">
  <Package name="SC" shortDescription="Stored Command">

    <DataTypeSet>

      <ContainerDataType name="AtsNum">
        <EntryList>
          <Entry name="id" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="RtsNum">
        <EntryList>
          <Entry name="id" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="CommandNum">
        <EntryList>
          <Entry name="id" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="EntryOffset">
        <EntryList>
          <Entry name="v" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <EnumeratedDataType name="Status">
          <EnumerationList>
            <Enumeration label="EMPTY" value="0" />
            <Enumeration label="LOADED" value="1" />
            <Enumeration label="IDLE" value="2" />
            <Enumeration label="EXECUTED" value="3" />
            <Enumeration label="SKIPPED" value="4" />
            <Enumeration label="EXECUTING" value="5" />
            <Enumeration label="FAILED_CHECKSUM" value="6" />
            <Enumeration label="FAILED_DISTRIB" value="7" />
            <Enumeration label="STARTING" value="8" />
          </EnumerationList>
          <IntegerDataEncoding sizeInBits="8" encoding="unsigned" />
      </EnumeratedDataType>

      <EnumeratedDataType name="Process">
          <EnumerationList>
            <Enumeration label="ATP" value="0" shortDescription="ATP process next"/>
            <Enumeration label="RTP" value="1" shortDescription="RTP process next"/>
            <Enumeration label="NONE" value="0xFF" shortDescription="No pending process"/>
          </EnumerationList>
          <IntegerDataEncoding sizeInBits="8" encoding="unsigned" />
      </EnumeratedDataType>

      <EnumeratedDataType name="AtsId">
          <EnumerationList>
            <Enumeration label="NO_ATS" value="0" />
            <Enumeration label="ATSA" value="1" />
            <Enumeration label="ATSB" value="2" />
          </EnumerationList>
          <IntegerDataEncoding sizeInBits="8" encoding="unsigned" />
      </EnumeratedDataType>

      <EnumeratedDataType name="TimeRef">
          <EnumerationList>
            <Enumeration label="USE_CFE_TIME" value="0" shortDescription="Use cFE configured time" />
            <Enumeration label="USE_TAI" value="1" shortDescription="Use TAI Time" />
            <Enumeration label="USE_UTC" value="2" shortDescription="Use UTC Time" />
          </EnumerationList>
          <IntegerDataEncoding sizeInBits="8" encoding="unsigned" />
      </EnumeratedDataType>

      <EnumeratedDataType name="AtsCont">
          <EnumerationList>
            <Enumeration label="FALSE" value="0" shortDescription="Do not continue on failure" />
            <Enumeration label="TRUE" value="1" shortDescription="Continue on failure" />
          </EnumerationList>
          <IntegerDataEncoding sizeInBits="8" encoding="unsigned" />
      </EnumeratedDataType>

      <ArrayDataType name="AtpFreeBytes" dataTypeRef="BASE_TYPES/uint32">
        <DimensionList>
          <Dimension size="${SC/NUMBER_OF_ATS}" />
        </DimensionList>
      </ArrayDataType>

      <ArrayDataType name="RtsStatusBits" dataTypeRef="BASE_TYPES/StatusBit">
        <DimensionList>
          <Dimension size="${SC/NUMBER_OF_RTS}" />
        </DimensionList>
      </ArrayDataType>

      <ContainerDataType name="HkTlm_Payload" shortDescription="SC housekeeping">
        <EntryList>
           <Entry name="AtsId" type="AtsId"  shortDescription="Current ATS ID: 1 = ATS A, 2 = ATS B" />
           <Entry name="AtpState" type="Status"  shortDescription="Current ATP state valid values are: 2 = IDLE, 5 = EXECUTING" />
           <Entry name="ContinueAtsOnFailureFlag" type="AtsCont"  shortDescription="In the event of ATS execution failure (ats command fails checksum), the ATS execution will continue if this flag is set to TRUE and will stop if this flag is set to FALSE" />
           <Entry name="CmdErrCtr" type="BASE_TYPES/uint8" shortDescription="Counts Request Errors" />
           <Entry name="CmdCtr" type="BASE_TYPES/uint8"  shortDescription="Counts Ground Requests"   />
           <Entry name="Padding8" type="BASE_TYPES/uint8" shortDescription="" />
           <Entry name="SwitchPendFlag" type="BASE_TYPES/uint16" shortDescription="is an ats switch pending? 0 = NO, 1 = YES  This means that the ATS switch is waiting until a safe time"  />
           <Entry name="NumRtsActive" type="BASE_TYPES/uint16" shortDescription="number of RTSs currently active" />
           <Entry name="RtsNum" type="RtsNum"  shortDescription=" next RTS number"  />
           <Entry name="RtsActiveCtr" type="BASE_TYPES/uint16" shortDescription="Increments when an RTS is started without error"  />
           <Entry name="RtsActiveErrCtr" type="BASE_TYPES/uint16" shortDescription="Increments when an attempt to start an RTS fails"  />
           <Entry name="AtsCmdCtr" type="BASE_TYPES/uint16" shortDescription="Total ATS cmd cnter counts commands sent by the ATS"  />
           <Entry name="AtsCmdErrCtr" type="BASE_TYPES/uint16" shortDescription="Total ATS cmd Error ctr command errors in the ATS"  />
           <Entry name="RtsCmdCtr" type="BASE_TYPES/uint16" shortDescription="Counts TOTAL rts cmds that were sent out from ALL active RTSs " />
           <Entry name="RtsCmdErrCtr" type="BASE_TYPES/uint16" shortDescription="Counts TOTAL number of errs from ALL RTSs that are active" />
           <Entry name="LastAtsErrSeq" type="AtsNum" shortDescription="Last ATS Errant Sequence Num Values: 1 or 2" />
           <Entry name="LastAtsErrCmd" type="CommandNum" shortDescription="Last ATS Errant Command Num " />
           <Entry name="LastRtsErrSeq" type="RtsNum"  shortDescription="Last RTS Errant Sequence Num " />
           <Entry name="LastRtsErrCmd" type="EntryOffset"  shortDescription="he OFFSET in the RTS buffer of the command that had an error  It will be a WORD value i.e. 1st command had an error, this value would be 0, if the 2nd command started at BASE_TYPES/int8 10 in the buffer, this value would be 5."  />
           <Entry name="AppendCmdArg" type="AtsNum"  shortDescription="ATS selection argument from most recent Append ATS command " />
           <Entry name="AppendEntryCount" type="BASE_TYPES/uint16" shortDescription="Number of cmd entries in current Append ATS table" />
           <Entry name="AppendByteCount" type="BASE_TYPES/uint16" shortDescription="Size of cmd entries in current Append ATS table" />
           <Entry name="AppendLoadCount" type="BASE_TYPES/uint16" shortDescription="Total number of Append ATS table loads"  />
           <Entry name="AtpCmdNumber" type="BASE_TYPES/uint32"  shortDescription="Current command number" />
           <Entry name="AtpFreeBytes" type="AtpFreeBytes"  shortDescription="Free Bytes in each ATS" />
           <Entry name="NextRtsTime" type="BASE_TYPES/uint32"  shortDescription="next RTS cmd Absolute Time" />
           <Entry name="NextAtsTime" type="BASE_TYPES/uint32"  shortDescription="Next ATS Command Time (seconds)" />
           <Entry name="RtsExecutingStatus" type="RtsStatusBits"  shortDescription="RTS disabled status bit map">
            <LongDescription>
             Each BASE_TYPES/uint16 represents 16 RTS numbers.
             Note: array index numbers and bit numbers use base zero indexing, but RTS numbers use base one indexing.
             Thus, the LSB (bit zero) of BASE_TYPES/uint16 array index zero represents RTS number 1, and bit one of BASE_TYPES/uint16
             array index zero represents RTS number 2, etc.  If an RTS is ENABLED, then the corresponding bit is zero.
             If an RTS is DISABLED, then the corresponding bit is one.
            </LongDescription>
           </Entry>
           <Entry name="RtsDisabledStatus" type="RtsStatusBits"  shortDescription="RTS executing status bit map">
            <LongDescription>
             Each BASE_TYPES/uint16 represents 16 RTS numbers.  Note: array
             index numbers and bit numbers use base zero indexing, but RTS numbers use base one indexing.  Thus,
             the LSB (bit zero) of BASE_TYPES/uint16 array index zero represents RTS number 1, and bit one of BASE_TYPES/uint16 array
             index zero represents RTS number 2, etc.  If an RTS is IDLE, then the corresponding bit is zero.
             If an RTS is EXECUTING, then the corresponding bit is one.
            </LongDescription>
           </Entry>

        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="StartAtsCmd_Payload" shortDescription="ATS Id Command">
        <EntryList>
          <Entry name="AtsNum" type="AtsNum" shortDescription="The ID of the ATS to start, 1 = ATS_A, 2 = ATS_B" />
          <Entry name="Padding" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="RtsCmd_Payload" shortDescription="RTS Id Command">
        <EntryList>
          <Entry name="RtsNum" type="RtsNum" shortDescription="The ID of the RTS to start/stop, 1 through #SC_MISSION_NUMBER_OF_RTS" />
          <Entry name="Padding" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="JumpAtsCmd_Payload" shortDescription="Jump running ATS to a new time Command">
        <EntryList>
          <Entry name="NewTime" type="BASE_TYPES/uint32" shortDescription="the time to 'jump' to" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="ContinueAtsOnFailureCmd_Payload" shortDescription="Continue ATS on failure command">
        <EntryList>
          <Entry name="ContinueState" type="AtsCont" shortDescription="TRUE or FALSE, to continue ATS after a failure" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="AppendAtsCmd_Payload" shortDescription="Append to ATS Command">
        <EntryList>
          <Entry name="AtsNum" type="AtsNum" shortDescription="The ID of the ATS to start, 1 = ATS_A, 2 = ATS_B" />
          <Entry name="Padding" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="RtsGrpCmd_Payload" shortDescription="RTS Group Command">
        <EntryList>
          <Entry name="FirstRtsNum" type="RtsNum" shortDescription="ID of the first RTS to act on, 1 through #SC_MISSION_NUMBER_OF_RTS" />
          <Entry name="LastRtsNum" type="RtsNum" shortDescription="ID of the Last RTS to act on, 1 through #SC_MISSION_NUMBER_OF_RTS" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="CMD" baseType="CFE_HDR/CommandHeader">
      </ContainerDataType>

      <ContainerDataType name="SendHkCmd" baseType="CFE_HDR/CommandHeader">
      </ContainerDataType>

      <ContainerDataType name="OneHzWakeupCmd" baseType="CFE_HDR/CommandHeader">
      </ContainerDataType>

      <ContainerDataType name="HkTlm" baseType="CFE_HDR/TelemetryHeader">
        <EntryList>
          <Entry type="HkTlm_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="NoopCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="0" />
        </ConstraintSet>
      </ContainerDataType>

      <ContainerDataType name="ResetCountersCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="1" />
        </ConstraintSet>
      </ContainerDataType>

      <ContainerDataType name="StartAtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="2" />
        </ConstraintSet>
        <EntryList>
          <Entry type="StartAtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="StopAtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="3" />
        </ConstraintSet>
      </ContainerDataType>

      <ContainerDataType name="StartRtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="4" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="StopRtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="5" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="DisableRtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="6" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="EnableRtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="7" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="SwitchAtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="8" />
        </ConstraintSet>
      </ContainerDataType>

      <ContainerDataType name="JumpAtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="9" />
        </ConstraintSet>
        <EntryList>
          <Entry type="JumpAtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="ContinueAtsOnFailureCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="10" />
        </ConstraintSet>
        <EntryList>
          <Entry type="ContinueAtsOnFailureCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="AppendAtsCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="11" />
        </ConstraintSet>
        <EntryList>
          <Entry type="AppendAtsCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="ManageTableCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="12" />
        </ConstraintSet>
        <EntryList>
          <Entry type="CFE_TBL/NotifyCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="StartRtsGrpCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="13" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsGrpCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="StopRtsGrpCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="14" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsGrpCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="DisableRtsGrpCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="15" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsGrpCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="EnableRtsGrpCmd" baseType="CMD">
        <ConstraintSet>
          <ValueConstraint entry="Sec.FunctionCode" value="16" />
        </ConstraintSet>
        <EntryList>
          <Entry type="RtsGrpCmd_Payload" name="Payload" />
        </EntryList>
      </ContainerDataType>


      <!-- TABLE DEFINITIONS -->
      <IntegerDataType name="AbsTimeTag" shortDescription="#SC_AbsTimeTag_t">
        <IntegerDataEncoding sizeInBits="32" encoding="unsigned" />
      </IntegerDataType>

      <IntegerDataType name="RelTimeTag" shortDescription="#SC_RelTimeTag_t">
        <IntegerDataEncoding sizeInBits="32" encoding="unsigned" />
      </IntegerDataType>


      <ContainerDataType name="AtsEntryHeader" shortDescription="ATS Entry">
        <EntryList>
          <Entry name="Pad" type="BASE_TYPES/uint16" shortDescription="Structure padding" />
          <Entry name="CmdNumber" type="CommandNum" shortDescription="ATS Command Number, range = 1 to SC_MAX_ATS_CMDS" />
          <Entry name="TimeTag_MS" type="BASE_TYPES/uint16" shortDescription="Time tag most significant 16 bits" />
          <Entry name="TimeTag_LS" type="BASE_TYPES/uint16" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="AtsEntry" shortDescription="ATS Entry">
        <EntryList>
          <Entry name="Header" type="AtsEntryHeader" shortDescription="ATS Header" />
          <Entry name="Msg" type="CFE_HDR/CommandHeader" shortDescription="Msg" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="RtsEntryHeader" shortDescription="RTS Entry">
        <EntryList>
          <Entry name="TimeTag" type="RelTimeTag" shortDescription="RTS Time" />
        </EntryList>
      </ContainerDataType>

      <ContainerDataType name="RtsEntry" shortDescription="RTS Entry">
        <EntryList>
          <Entry name="Header" type="RtsEntryHeader" shortDescription="RTS Header" />
          <Entry name="Msg" type="CFE_HDR/CommandHeader" shortDescription="Msg" />
        </EntryList>
      </ContainerDataType>

      <ArrayDataType name="AtsTable" dataTypeRef="AtsEntry" shortDescription="ATS Table">
        <DimensionList>
          <Dimension size="${SC/MAX_ATS_CMDS}" />
        </DimensionList>
      </ArrayDataType>

      <!-- attribute 'size' could not be resolved - Can't find MAX_RTS_CMDS and MAX_APPEND_CMDS
     <ArrayDataType name="AppendTable" dataTypeRef="AtsEntry" shortDescription="Append Table">
        <DimensionList>
          <Dimension size="${SC/MAX_APPEND_CMDS}" />
        </DimensionList>
      </ArrayDataType>

      <ArrayDataType name="RtsTable" dataTypeRef="RtsEntryHeader_Payload" shortDescription="RTS Table">
        <DimensionList>
          <Dimension size="${SC/MAX_RTS_CMDS}" />
        </DimensionList>
      </ArrayDataType>
      -->

    </DataTypeSet>

    <ComponentSet>
      <Component name="Application">
        <RequiredInterfaceSet>
          <Interface name="CMD" shortDescription="Software bus telecommand interface" type="CFE_SB/Telecommand">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelecommandDataType" type="CMD" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="SEND_HK" shortDescription="Send telemetry command interface" type="CFE_SB/Telecommand">
            <!-- This uses a bare spacepacket with no payload -->
            <GenericTypeMapSet>
              <GenericTypeMap name="TelecommandDataType" type="SendHkCmd" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="ONEHZ_WAKEUP" shortDescription="1Hz wakeup command" type="CFE_SB/Telecommand">
            <!-- This uses a bare spacepacket with no payload -->
            <GenericTypeMapSet>
              <GenericTypeMap name="TelecommandDataType" type="OneHzWakeupCmd" />
            </GenericTypeMapSet>
          </Interface>
          <Interface name="HK_TLM" shortDescription="Software bus housekeeping telemetry interface" type="CFE_SB/Telemetry">
            <GenericTypeMapSet>
              <GenericTypeMap name="TelemetryDataType" type="HkTlm" />
            </GenericTypeMapSet>
          </Interface>
        </RequiredInterfaceSet>
        <Implementation>
          <VariableSet>
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="CmdTopicId" initialValue="${CFE_MISSION/SC_CMD_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="SendHkTopicId" initialValue="${CFE_MISSION/SC_SEND_HK_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="OneHzWakeupTopicId" initialValue="${CFE_MISSION/SC_ONEHZ_WAKEUP_TOPICID}" />
            <Variable type="BASE_TYPES/uint16" readOnly="true" name="HkTlmTopicId" initialValue="${CFE_MISSION/SC_HK_TLM_TOPICID}" />
          </VariableSet>
          <!-- Assign fixed numbers to the "TopicId" parameter of each interface -->
          <ParameterMapSet>
            <ParameterMap interface="CMD" parameter="TopicId" variableRef="CmdTopicId" />
            <ParameterMap interface="SEND_HK" parameter="TopicId" variableRef="SendHkTopicId" />
            <ParameterMap interface="ONEHZ_WAKEUP" parameter="TopicId" variableRef="OneHzWakeupTopicId" />
            <ParameterMap interface="HK_TLM" parameter="TopicId" variableRef="HkTlmTopicId" />
          </ParameterMapSet>
        </Implementation>
      </Component>
    </ComponentSet>

  </Package>
</PackageFile>
